
<link rel="stylesheet" href="../assets/style.css">
<div class="split" style="padding:18px">
  <div>
    <div class="row" style="justify-content: space-between; margin-bottom: 10px;">
      <h3 style="margin:0">Quick Commands</h3>
      <div class="os-toggle" role="radiogroup" aria-label="Chọn hệ điều hành">
        <input type="radio" name="os" id="os-unix" checked>
        <label for="os-unix">Linux/macOS</label>
        <input type="radio" name="os" id="os-win">
        <label for="os-win">Windows</label>
      </div>
    </div>
    <div class="tool" style="margin-bottom:12px;">
      <div class="cmd">
        <code id="cmd-ping">ping -c 4 example.com</code>
        <button class="btn" data-copy="cmd-ping">Copy</button>
      </div>
    </div>
    <div class="tool" style="margin-bottom:12px;">
      <div class="cmd">
        <code id="cmd-trace">traceroute example.com</code>
        <button class="btn" data-copy="cmd-trace">Copy</button>
      </div>
    </div>
    <div class="tool" style="margin-bottom:12px;">
      <div class="cmd">
        <code id="cmd-dns">dig +short A example.com</code>
        <button class="btn" data-copy="cmd-dns">Copy</button>
      </div>
    </div>
    <div class="tool" style="margin-bottom:12px;">
      <div class="cmd">
        <code id="cmd-mtr">mtr -rwzbc 100 example.com</code>
        <button class="btn" data-copy="cmd-mtr">Copy</button>
      </div>
    </div>
  </div>

  <div>
    <div class="tool" style="margin-bottom:12px;">
      <h4>CIDR/Subnet Calculator</h4>
      <p class="mini">Nhập IP/CIDR, ví dụ: <code>192.168.1.10/24</code> hoặc <code>10.0.0.1/30</code></p>
      <input id="cidrInput" placeholder="192.168.1.10/24"/>
      <div class="row" style="justify-content:flex-end; margin-top:8px;">
        <button class="btn" id="calcBtn">Tính</button>
      </div>
      <pre class="code" id="cidrResult" aria-live="polite"></pre>
    </div>

    <div class="tool">
      <h4>IP ⇄ Integer</h4>
      <div class="row">
        <input id="ipInput" placeholder="192.168.1.1" style="flex:1;"/>
        <button class="btn" id="ipToInt">IP → Int</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <input id="intInput" placeholder="3232235777" style="flex:1;"/>
        <button class="btn" id="intToIp">Int → IP</button>
      </div>
    </div>
  </div>
</div>
<script>
(function(){
  const osUnix = document.getElementById('os-unix');
  const osWin  = document.getElementById('os-win');
  function setCommands() {
    const isWin = osWin.checked;
    document.getElementById('cmd-ping').textContent  = isWin ? 'ping -n 4 example.com' : 'ping -c 4 example.com';
    document.getElementById('cmd-trace').textContent = isWin ? 'tracert example.com' : 'traceroute example.com';
    document.getElementById('cmd-dns').textContent   = isWin ? 'nslookup example.com' : 'dig +short A example.com';
    document.getElementById('cmd-mtr').textContent   = isWin ? 'pathping -q 100 example.com' : 'mtr -rwzbc 100 example.com';
  }
  osUnix.addEventListener('change', setCommands);
  osWin.addEventListener('change', setCommands);
  setCommands();

  document.querySelectorAll('[data-copy]').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-copy');
      const code = document.getElementById(id).textContent;
      navigator.clipboard.writeText(code).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 1200);
      });
    });
  });

  function ipToInt(ip) {
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n) || n < 0 || n > 255)) return null;
    return ((parts[0]<<24) | (parts[1]<<16) | (parts[2]<<8) | parts[3]) >>> 0;
  }
  function intToIp(int) {
    return [int>>>24 & 255, int>>>16 & 255, int>>>8 & 255, int & 255].join('.');
  }
  function maskFromPrefix(p) {
    p = Number(p);
    if (!(p >= 0 && p <= 32)) return null;
    return p === 0 ? 0 : (0xFFFFFFFF << (32 - p)) >>> 0;
  }
  document.getElementById('calcBtn').addEventListener('click', () => {
    const input = document.getElementById('cidrInput').value.trim();
    const out = document.getElementById('cidrResult');
    const m = input.match(/^([^\/]+)\/(\d{1,2})$/);
    if (!m) { out.textContent = '⚠️ Định dạng không hợp lệ. Ví dụ: 192.168.1.10/24'; return; }
    const ip = ipToInt(m[1]);
    const p = Number(m[2]);
    const mask = maskFromPrefix(p);
    if (ip === null || mask === null) { out.textContent = '⚠️ IP hoặc prefix không hợp lệ.'; return; }
    const network = (ip & mask) >>> 0;
    const broadcast = (network | (~mask >>> 0)) >>> 0;
    const usable = p >= 31 ? (p === 31 ? 2 : 1) : Math.max(0, (2 ** (32 - p)) - 2);
    const firstHost = p >= 31 ? network : (network + 1) >>> 0;
    const lastHost  = p >= 31 ? broadcast : (broadcast - 1) >>> 0;
    out.textContent = `IP: ${intToIp(ip)}\nPrefix: /${p}\nMask: ${intToIp(mask)}\nNetwork: ${intToIp(network)}\nBroadcast: ${intToIp(broadcast)}\nUsable hosts: ${usable}\nFirst host: ${intToIp(firstHost)}\nLast host: ${intToIp(lastHost)}`;
  });

  document.getElementById('ipToInt').addEventListener('click', () => {
    const ip = document.getElementById('ipInput').value.trim();
    const parts = ip.split('.').map(Number);
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n) || n < 0 || n > 255)) { alert('IP không hợp lệ'); return; }
    const val = ((parts[0]<<24) | (parts[1]<<16) | (parts[2]<<8) | parts[3]) >>> 0;
    alert(val);
  });
  document.getElementById('intToIp').addEventListener('click', () => {
    const num = Number(document.getElementById('intInput').value.trim());
    if (!Number.isFinite(num) || num < 0 || num > 0xFFFFFFFF) { alert('Số không hợp lệ (0..4294967295)'); return; }
    const int = num >>> 0;
    const ip = [int>>>24 & 255, int>>>16 & 255, int>>>8 & 255, int & 255].join('.');
    alert(ip);
  });
})();
</script>
