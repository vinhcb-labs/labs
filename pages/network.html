<link rel="stylesheet" href="../assets/style.css">
<div style="padding:18px">
  <h3 style="margin:0 0 12px 0">Network</h3>
  <div class="tool">
    <h4 style="margin:0">IP PUBLIC: <code id="publicIp">Đang lấy…</code></h4>
    <div class="mini" style="margin-top:6px">
      Địa chỉ IP mà Internet nhìn thấy từ mạng của bạn (WAN egress).
    </div>
  </div>
</div>
<script>
const ipv4re = /^(?:\d{1,3}\.){3}\d{1,3}$/;
const ipv6re = /^[0-9a-f:]+$/i;
async function fetchJSON(u){ const r = await fetch(u, { cache: 'no-store' }); return await r.json(); }
async function fetchTEXT(u){ const r = await fetch(u, { cache: 'no-store' }); return await r.text(); }
async function tryAll(tasks){ for (const t of tasks){ try{ const v = await t(); if (v) return v; }catch{} } return ''; }
async function getIPv4(){ return await tryAll([
  async()=>{ const j = await fetchJSON('https://api.ipify.org?format=json'); return ipv4re.test(j.ip)? j.ip : ''; },
  async()=>{ const j = await fetchJSON('https://api4.ipify.org?format=json'); return ipv4re.test(j.ip)? j.ip : ''; },
  async()=>{ const v = (await fetchTEXT('https://ifconfig.me/ip')).trim(); return ipv4re.test(v)? v : ''; },
]);}
async function getIPv6(){ return await tryAll([
  async()=>{ const j = await fetchJSON('https://api64.ipify.org?format=json'); return ipv6re.test(j.ip)? j.ip : ''; },
  async()=>{ const v = (await fetchTEXT('https://ipv6.icanhazip.com/')).trim(); return ipv6re.test(v)? v : ''; },
]);}
(async function init(){
  const el = document.getElementById('publicIp');
  el.textContent = 'Đang lấy…';
  try{
    const [v4, v6] = await Promise.all([getIPv4(), getIPv6()]);
    el.textContent = v4 || v6 || '—';
  }catch{ el.textContent = '⚠️ Lỗi lấy IP'; }
})();
</script>