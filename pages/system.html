<link rel="stylesheet" href="../assets/style.css">
<div style="padding:18px">
  <h3 style="margin:0 0 12px 0">System Tools</h3>

  <div class="tool" id="passwordGen">
    <h4>Tạo mật khẩu ngẫu nhiên (đủ nhóm ký tự)</h4>
    <div class="row" style="gap:8px; align-items:flex-end; flex-wrap:wrap">
      <div style="flex:1">
        <label>Độ dài</label>
        <input id="pwLen" type="number" value="16" min="8" max="128"/>
      </div>
      <div style="flex:2; display:grid; grid-template-columns: repeat(4, minmax(90px, 1fr)); gap:8px">
        <label><input type="checkbox" id="pwLower" checked/> a-z</label>
        <label><input type="checkbox" id="pwUpper" checked/> A-Z</label>
        <label><input type="checkbox" id="pwDigit" checked/> 0-9</label>
        <label><input type="checkbox" id="pwSymbol" checked/> !@#$…</label>
      </div>
      <button class="btn" id="pwMake">Tạo</button>
      <button class="btn secondary" id="pwCopy">Copy</button>
    </div>
    <input id="pwOut" readonly placeholder="Mật khẩu sẽ hiện ở đây" style="margin-top:8px"/>
    <div class="mini">Dùng Web Crypto (CSPRNG). Đảm bảo có ít nhất 1 ký tự từ mỗi nhóm đã chọn.</div>
  </div>
</div>

<script>
// === Password Generator ===
(function(){
  const rnd = (n) => {
    const a = new Uint32Array(n);
    crypto.getRandomValues(a);
    return a;
  };
  const pick = (charset, count=1) => {
    const out = [];
    const arr = rnd(count);
    for (let i=0;i<count;i++){
      out.push(charset[arr[i] % charset.length]);
    }
    return out;
  };
  function gen(){
    const len = Math.min(128, Math.max(8, parseInt(document.getElementById('pwLen').value,10) || 16));
    const sets = [];
    const lower = 'abcdefghijklmnopqrstuvwxyz';
    const upper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const digit = '0123456789';
    const symbol = '!@#$%^&*()_+-=[]{}|;:,.<>?/~';
    if (document.getElementById('pwLower').checked) sets.push(lower);
    if (document.getElementById('pwUpper').checked) sets.push(upper);
    if (document.getElementById('pwDigit').checked) sets.push(digit);
    if (document.getElementById('pwSymbol').checked) sets.push(symbol);
    if (sets.length === 0){ alert('Chọn ít nhất 1 nhóm ký tự'); return; }

    const required = sets.map(s => pick(s, 1)[0]);
    const mega = sets.join('');
    const remaining = pick(mega, Math.max(len - required.length, 0));
    const all = required.concat(remaining);
    const rand = rnd(all.length);
    for (let i = all.length - 1; i > 0; i--) {
      const j = rand[i] % (i + 1);
      [all[i], all[j]] = [all[j], all[i]];
    }
    document.getElementById('pwOut').value = all.join('');
  }
  document.getElementById('pwMake')?.addEventListener('click', gen);
  document.getElementById('pwCopy')?.addEventListener('click', async ()=>{
    const t = document.getElementById('pwOut').value;
    if (!t) return;
    try { await navigator.clipboard.writeText(t); } catch {}
  });
})();
</script>